{{- if .Values.setupScript.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "xanthus-code-server.fullname" . }}-setup-script
  labels:
    {{- include "xanthus-code-server.labels" . | nindent 4 }}
data:
  setup-dev-environment.sh: |
    #!/bin/bash
    set -e
    
    echo "ğŸš€ Setting up development environment..."
    echo "ğŸ“ Your home directory is persistent - all changes will be saved!"
    echo "Run with: bash ~/setup-dev-environment.sh"
    echo ""
    
    # Check if already installed
    if [ -f ~/.dev-environment-setup ]; then
        echo "âœ… Development environment already set up!"
        echo "ğŸ“ To reinstall, delete ~/.dev-environment-setup and run again"
        exit 0
    fi
    
    # Update package lists
    echo "ğŸ“¦ Updating package lists..."
    sudo apt-get update -qq
    
    # Install Node.js and npm
    echo "ğŸ“¦ Installing Node.js and npm..."
    sudo apt-get install -y nodejs npm
    
    # Install Python3 and pip
    echo "ğŸ“¦ Installing Python3 and pip..."
    sudo apt-get install -y python3 python3-pip
    
    # Install Go
    echo "ğŸ“¦ Installing Go..."
    sudo apt-get install -y golang-go
    
    # Install Docker
    echo "ğŸ“¦ Installing Docker..."
    sudo apt-get install -y docker.io
    sudo usermod -aG docker coder
    
    # Install kubectl
    echo "ğŸ“¦ Installing kubectl..."
    curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
    sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
    rm kubectl
    
    # Install Helm
    echo "ğŸ“¦ Installing Helm..."
    curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
    
    # Install common development tools
    echo "ğŸ“¦ Installing development tools..."
    sudo apt-get install -y \
        git curl wget vim nano \
        htop tree jq yq \
        build-essential
    
    # Install global npm packages (in user home - persistent!)
    echo "ğŸ“¦ Installing global npm packages..."
    npm install -g typescript @angular/cli @vue/cli create-react-app
    
    # Install Python packages (in user home - persistent!)
    echo "ğŸ“¦ Installing Python packages..."
    pip3 install --user \
        requests beautifulsoup4 \
        pandas numpy matplotlib \
        flask fastapi uvicorn
    
    # Setup Git configuration
    echo "ğŸ“ Setting up Git configuration..."
    git config --global user.name "Coder"
    git config --global user.email "coder@example.com"
    git config --global init.defaultBranch main
    
    # Create common directories
    echo "ğŸ“ Creating project directories..."
    mkdir -p ~/projects ~/workspace ~/scripts
    
    # Create setup completion marker
    echo "$(date): Development environment setup completed" > ~/.dev-environment-setup
    
    # Clean up
    echo "ğŸ§¹ Cleaning up..."
    sudo apt-get autoremove -y
    sudo apt-get autoclean
    
    echo "âœ… Development environment setup complete!"
    echo "ğŸ“ Everything is saved in your persistent home directory"
    echo "ğŸ“ Note: You may need to restart your terminal for some changes to take effect"
    echo "ğŸ³ Note: Docker requires logout/login to use without sudo"
    echo "ğŸ“‚ Your projects directory: ~/projects"
    echo "ğŸ“‚ Your workspace directory: ~/workspace"
{{- end }}
---
{{- if .Values.vscodeSettings.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "xanthus-code-server.fullname" . }}-vscode-settings
  labels:
    {{- include "xanthus-code-server.labels" . | nindent 4 }}
data:
  settings.json: |
    {
      "workbench.colorTheme": "Default Dark+",
      "editor.fontSize": 14,
      "editor.tabSize": 2,
      "editor.insertSpaces": true,
      "files.autoSave": "afterDelay",
      "files.autoSaveDelay": 1000,
      "terminal.integrated.fontSize": 14,
      "extensions.autoUpdate": false,
      "extensions.autoCheckUpdates": false,
      "telemetry.enableTelemetry": false,
      "update.mode": "none"
    }
{{- end }}