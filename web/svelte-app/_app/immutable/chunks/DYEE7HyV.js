var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{w as s,b as r,d as i}from"./Dr171qo1.js";const o={},n=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),n=i?.nonce||i?.getAttribute("nonce");r=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,s),t in o)return;o[t]=!0;const r=t.endsWith(".css"),i=r?'[rel="stylesheet"]':"";if(!!s)for(let s=e.length-1;s>=0;s--){const i=e[s];if(i.href===t&&(!r||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;const a=document.createElement("link");return a.rel=r?"stylesheet":"modulepreload",r||(a.as="script"),a.crossOrigin="",a.href=t,n&&a.setAttribute("nonce",n),document.head.appendChild(a),r?new Promise((e,s)=>{a.addEventListener("load",e),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},a=s({loading:!1,loadingTitle:"Processing...",loadingMessage:"Please wait while the operation completes.",currentPage:"",modals:{}}),c=(e,t)=>{a.update(s=>({...s,loading:!0,loadingTitle:e,loadingMessage:t}))},l=()=>{a.update(e=>({...e,loading:!1}))},d=e=>{a.update(t=>({...t,currentPage:e}))},h=e=>{a.update(t=>({...t,loadingTitle:e}))},u=e=>{a.update(t=>({...t,loadingMessage:e}))};const p=new class{constructor(){t(this,"notifications",[]),t(this,"notificationListeners",[]),t(this,"maxNotifications",5)}async handleAPIError(e,t,s){console.error(`API Error in ${t}:`,e);const r={message:this.extractErrorMessage(e),code:e.status||e.code,timestamp:Date.now(),context:t,retryable:this.isRetryableError(e)};await this.showErrorNotification(r,s),this.logError(r,e)}async handleNetworkError(e,t){const s={message:"Network connection failed. Please check your internet connection.",timestamp:Date.now(),context:e,retryable:!0};await this.showErrorNotification(s,t)}async handleValidationError(e,t){const s=Array.isArray(e)?e:[e],r=1===s.length?s[0]:`${s.length} validation errors occurred`,i={id:this.generateId(),type:"warning",title:"Validation Error",message:r,timestamp:Date.now(),dismissible:!0,autoClose:8};this.addNotification(i)}showSuccess(e,t,s=5){const r={id:this.generateId(),type:"success",title:e,message:t,timestamp:Date.now(),dismissible:!0,autoClose:s};this.addNotification(r)}showInfo(e,t,s=8){const r={id:this.generateId(),type:"info",title:e,message:t,timestamp:Date.now(),dismissible:!0,autoClose:s};this.addNotification(r)}showWarning(e,t,s=10){const r={id:this.generateId(),type:"warning",title:e,message:t,timestamp:Date.now(),dismissible:!0,autoClose:s};this.addNotification(r)}subscribe(e){return this.notificationListeners.push(e),e([...this.notifications]),()=>{const t=this.notificationListeners.indexOf(e);t>-1&&this.notificationListeners.splice(t,1)}}dismiss(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.notifyListeners()}clearAll(){this.notifications=[],this.notifyListeners()}async showErrorNotification(e,t){const s=[];t&&e.retryable&&s.push({label:"Retry",action:t,primary:!0});const i={id:this.generateId(),type:"error",title:this.getErrorTitle(e),message:e.message,timestamp:e.timestamp,dismissible:!0,actions:s.length>0?s:void 0};if(this.addNotification(i),this.isCriticalError(e)&&r)try{const{default:t}=await n(async()=>{const{default:e}=await import("./CT2pLRIc.js");return{default:e}},[],import.meta.url);await t.fire({title:"Critical Error",text:e.message,icon:"error",confirmButtonColor:"#ef4444"})}catch(o){console.error("Failed to show critical error dialog:",o)}}extractErrorMessage(e){return"string"==typeof e?e:e?.message?e.message:e?.error?e.error:e?.details?e.details:e?.statusText?e.statusText:e?.response?.data?.error?e.response.data.error:e?.response?.data?.message?e.response.data.message:"An unexpected error occurred"}isRetryableError(e){const t=e?.status||e?.response?.status;return!t||(t>=500||(429===t||408===t))}isCriticalError(e){return 401===e.code||403===e.code||("number"==typeof e.code&&e.code>=500||(!(!e.context?.includes("deployment")||!e.message.includes("failed"))||!(!e.context?.includes("vps")||!e.message.includes("unreachable"))))}getErrorTitle(e){if(401===e.code)return"Authentication Required";if(403===e.code)return"Access Denied";if(404===e.code)return"Resource Not Found";if(429===e.code)return"Rate Limited";if("number"==typeof e.code&&e.code>=500)return"Server Error";if(e.context){const t={vps:"VPS Error",applications:"Application Error",dns:"DNS Error",version:"Version Management Error",auth:"Authentication Error"};for(const[s,r]of Object.entries(t))if(e.context.toLowerCase().includes(s))return r}return"Error"}addNotification(e){this.notifications.unshift(e),this.notifications.length>this.maxNotifications&&(this.notifications=this.notifications.slice(0,this.maxNotifications)),e.autoClose&&setTimeout(()=>{this.dismiss(e.id)},1e3*e.autoClose),this.notifyListeners()}notifyListeners(){this.notificationListeners.forEach(e=>{e([...this.notifications])})}logError(e,t){const s={timestamp:new Date(e.timestamp).toISOString(),context:e.context,message:e.message,code:e.code,userAgent:navigator.userAgent,url:window.location.href,originalError:t?JSON.stringify(t,null,2):void 0};console.group(`ðŸš¨ Error in ${e.context}`),console.error("Error Details:",s),t&&console.error("Original Error:",t),console.groupEnd()}generateId(){return Math.random().toString(36).substr(2,9)}};class f extends Error{constructor(e,t,s){super(e),this.status=t,this.response=s,this.name="ApiError"}}const m=new class{constructor(){t(this,"baseUrl","/api")}async get(e,t="API",s=!0){try{const t=await fetch(`${this.baseUrl}${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.handleResponse(t)}catch(r){throw s&&await this.handleError(r,t),r}}async post(e,t,s="API",r=!0){try{const s=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});return await this.handleResponse(s)}catch(i){throw r&&await this.handleError(i,s),i}}async put(e,t){const s=await fetch(`${this.baseUrl}${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});return this.handleResponse(s)}async delete(e){const t=await fetch(`${this.baseUrl}${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});return this.handleResponse(t)}async handleResponse(e){if(!e.ok){let t=`HTTP ${e.status}: ${e.statusText}`;try{const s=await e.json();t=s.error||s.message||t}catch{}throw new f(t,e.status,e)}const t=e.headers.get("Content-Type");if(!t||!t.includes("application/json"))return{};try{return await e.json()}catch{return{}}}async handleError(e,t){this.isNetworkError(e)?await p.handleNetworkError(t):await p.handleAPIError(e,t)}isNetworkError(e){return!e.status&&(e.message?.includes("NetworkError")||e.message?.includes("Failed to fetch")||e.message?.includes("fetch")||"TypeError"===e.name)}async legacyGet(e){const t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});return this.handleResponse(t)}async legacyPost(e,t){const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});return this.handleResponse(s)}async legacyDelete(e){const t=await fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json"}});return this.handleResponse(t)}},g=s({user:null,loading:!1,error:null,isAuthenticated:!1});i(g,e=>e.user),i(g,e=>e.isAuthenticated),i(g,e=>e.loading),i(g,e=>e.error);const y=e=>{g.update(t=>({...t,user:e,isAuthenticated:!!e,error:null}))},w=e=>{g.update(t=>({...t,loading:e}))},E=async()=>{w(!0);try{const e=await fetch("/auth/status");if(e.ok){const t=await e.json();t.authenticated?y(t.user||{id:"1",username:"user",isAuthenticated:!0}):y(null)}else y(null)}catch(e){console.error("Auth check error:",e),y(null)}finally{w(!1)}};export{n as _,m as a,h as b,l as c,u as d,p as e,E as f,d as g,c as s,a as u};
