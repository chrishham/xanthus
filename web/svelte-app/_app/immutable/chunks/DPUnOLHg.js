var e=Object.defineProperty,t=(t,r,s)=>((t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s)(t,"symbol"!=typeof r?r+"":r,s);import{w as r,b as s,d as o}from"./ChrfcdU-.js";const n={},i=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),i=o?.nonce||o?.getAttribute("nonce");s=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,r),t in n)return;n[t]=!0;const s=t.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(!!r)for(let r=e.length-1;r>=0;r--){const o=e[r];if(o.href===t&&(!s||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${t}"]${o}`))return;const a=document.createElement("link");return a.rel=s?"stylesheet":"modulepreload",s||(a.as="script"),a.crossOrigin="",a.href=t,i&&a.setAttribute("nonce",i),document.head.appendChild(a),s?new Promise((e,r)=>{a.addEventListener("load",e),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})},a=r({loading:!1,loadingTitle:"Processing...",loadingMessage:"Please wait while the operation completes.",currentPage:"",modals:{}}),c=(e,t)=>{a.update(r=>({...r,loading:!0,loadingTitle:e,loadingMessage:t}))},l=()=>{a.update(e=>({...e,loading:!1}))},d=e=>{a.update(t=>({...t,currentPage:e}))},h=e=>{a.update(t=>({...t,loadingTitle:e}))},u=e=>{a.update(t=>({...t,loadingMessage:e}))};const p=new class{constructor(){t(this,"notifications",[]),t(this,"notificationListeners",[]),t(this,"maxNotifications",5)}async handleAPIError(e,t,r){console.error(`API Error in ${t}:`,e);const s={message:this.extractErrorMessage(e),code:e.status||e.code,timestamp:Date.now(),context:t,retryable:this.isRetryableError(e)};await this.showErrorNotification(s,r),this.logError(s,e)}async handleNetworkError(e,t){const r={message:"Network connection failed. Please check your internet connection.",timestamp:Date.now(),context:e,retryable:!0};await this.showErrorNotification(r,t)}async handleValidationError(e,t){const r=Array.isArray(e)?e:[e],s=1===r.length?r[0]:`${r.length} validation errors occurred`,o={id:this.generateId(),type:"warning",title:"Validation Error",message:s,timestamp:Date.now(),dismissible:!0,autoClose:8};this.addNotification(o)}showSuccess(e,t,r=5){const s={id:this.generateId(),type:"success",title:e,message:t,timestamp:Date.now(),dismissible:!0,autoClose:r};this.addNotification(s)}showInfo(e,t,r=8){const s={id:this.generateId(),type:"info",title:e,message:t,timestamp:Date.now(),dismissible:!0,autoClose:r};this.addNotification(s)}showWarning(e,t,r=10){const s={id:this.generateId(),type:"warning",title:e,message:t,timestamp:Date.now(),dismissible:!0,autoClose:r};this.addNotification(s)}subscribe(e){return this.notificationListeners.push(e),e([...this.notifications]),()=>{const t=this.notificationListeners.indexOf(e);t>-1&&this.notificationListeners.splice(t,1)}}dismiss(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.notifyListeners()}clearAll(){this.notifications=[],this.notifyListeners()}async showErrorNotification(e,t){const r=[];t&&e.retryable&&r.push({label:"Retry",action:t,primary:!0});const o={id:this.generateId(),type:"error",title:this.getErrorTitle(e),message:e.message,timestamp:e.timestamp,dismissible:!0,actions:r.length>0?r:void 0};if(this.addNotification(o),this.isCriticalError(e)&&s)try{const{default:t}=await i(async()=>{const{default:e}=await import("./CT2pLRIc.js");return{default:e}},[],import.meta.url);await t.fire({title:"Critical Error",text:e.message,icon:"error",confirmButtonColor:"#ef4444"})}catch(n){console.error("Failed to show critical error dialog:",n)}}extractErrorMessage(e){return"string"==typeof e?e:e?.message?e.message:e?.error?e.error:e?.details?e.details:e?.statusText?e.statusText:e?.response?.data?.error?e.response.data.error:e?.response?.data?.message?e.response.data.message:"An unexpected error occurred"}isRetryableError(e){const t=e?.status||e?.response?.status;return!t||(t>=500||(429===t||408===t))}isCriticalError(e){return 401===e.code||403===e.code||("number"==typeof e.code&&e.code>=500||(!(!e.context?.includes("deployment")||!e.message.includes("failed"))||!(!e.context?.includes("vps")||!e.message.includes("unreachable"))))}getErrorTitle(e){if(401===e.code)return"Authentication Required";if(403===e.code)return"Access Denied";if(404===e.code)return"Resource Not Found";if(429===e.code)return"Rate Limited";if("number"==typeof e.code&&e.code>=500)return"Server Error";if(e.context){const t={vps:"VPS Error",applications:"Application Error",dns:"DNS Error",version:"Version Management Error",auth:"Authentication Error"};for(const[r,s]of Object.entries(t))if(e.context.toLowerCase().includes(r))return s}return"Error"}addNotification(e){this.notifications.unshift(e),this.notifications.length>this.maxNotifications&&(this.notifications=this.notifications.slice(0,this.maxNotifications)),e.autoClose&&setTimeout(()=>{this.dismiss(e.id)},1e3*e.autoClose),this.notifyListeners()}notifyListeners(){this.notificationListeners.forEach(e=>{e([...this.notifications])})}logError(e,t){const r={timestamp:new Date(e.timestamp).toISOString(),context:e.context,message:e.message,code:e.code,userAgent:navigator.userAgent,url:window.location.href,originalError:t?JSON.stringify(t,null,2):void 0};console.group(`ðŸš¨ Error in ${e.context}`),console.error("Error Details:",r),t&&console.error("Original Error:",t),console.groupEnd()}generateId(){return Math.random().toString(36).substr(2,9)}},f=r({user:null,tokens:null,loading:!1,error:null,isAuthenticated:!1});o(f,e=>e.user),o(f,e=>e.isAuthenticated),o(f,e=>e.loading),o(f,e=>e.error);const m="xanthus_tokens",g=()=>{try{const e=localStorage.getItem(m);if(!e)return null;const t=JSON.parse(e);return{access_token:t.access_token,refresh_token:t.refresh_token,token_type:t.token_type,expires_in:t.expires_in}}catch{return null}},y=e=>{f.update(t=>({...t,tokens:e})),e?(e=>{localStorage.setItem(m,JSON.stringify({...e,expires_at:Date.now()+1e3*e.expires_in}))})(e):localStorage.removeItem(m)},w=async()=>{const e=g();if(!e?.refresh_token)return!1;try{const r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token})});if(r.ok){const e=await r.json();return y(e),!0}return y(null),t=null,f.update(e=>({...e,user:t,isAuthenticated:!1,error:null})),window.location.href="/login",!1}catch(r){return console.error("Token refresh error:",r),!1}var t},E=async(e,t={})=>{(()=>{try{const e=localStorage.getItem(m);if(!e)return!1;const t=JSON.parse(e);return Date.now()>=t.expires_at-3e5}catch{return!1}})()&&await w();const r=g();if(!r)throw new Error("No authentication tokens available");return fetch(e,{...t,headers:{...t.headers,Authorization:`${r.token_type} ${r.access_token}`}})};class b extends Error{constructor(e,t,r){super(e),this.status=t,this.response=r,this.name="ApiError"}}const T=new class{constructor(){t(this,"baseUrl","/api")}async get(e,t="API",r=!0){try{const t=await E(`${this.baseUrl}${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.handleResponse(t)}catch(s){throw r&&await this.handleError(s,t),s}}async post(e,t,r="API",s=!0){try{const r=await E(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});return await this.handleResponse(r)}catch(o){throw s&&await this.handleError(o,r),o}}async put(e,t){const r=await E(`${this.baseUrl}${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});return this.handleResponse(r)}async delete(e){const t=await E(`${this.baseUrl}${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});return this.handleResponse(t)}async handleResponse(e){if(!e.ok){let t=`HTTP ${e.status}: ${e.statusText}`;try{const r=await e.json();t=r.error||r.message||t}catch{}throw new b(t,e.status,e)}const t=e.headers.get("Content-Type");if(!t||!t.includes("application/json"))return{};try{return await e.json()}catch{return{}}}async handleError(e,t){this.isNetworkError(e)?await p.handleNetworkError(t):await p.handleAPIError(e,t)}isNetworkError(e){return!e.status&&(e.message?.includes("NetworkError")||e.message?.includes("Failed to fetch")||e.message?.includes("fetch")||"TypeError"===e.name)}async legacyGet(e){const t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});return this.handleResponse(t)}async legacyPost(e,t){const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});return this.handleResponse(r)}async legacyDelete(e){const t=await fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json"}});return this.handleResponse(t)}};export{i as _,T as a,f as b,l as c,d,p as e,h as f,u as g,c as s,a as u};
