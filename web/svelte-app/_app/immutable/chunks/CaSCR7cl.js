function W(x,R){for(var w=0;w<R.length;w++){const g=R[w];if(typeof g!="string"&&!Array.isArray(g)){for(const v in g)if(v!=="default"&&!(v in x)){const C=Object.getOwnPropertyDescriptor(g,v);C&&Object.defineProperty(x,v,C.get?C:{enumerable:!0,get:()=>g[v]})}}}return Object.freeze(Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}))}var I={exports:{}};(function(x,R){(function(w,g){x.exports=g()})(self,()=>(()=>{var w={345:(m,l)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.runAndSubscribe=l.forwardEvent=l.EventEmitter=void 0,l.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=c=>(this._listeners.push(c),{dispose:()=>{if(!this._disposed){for(let a=0;a<this._listeners.length;a++)if(this._listeners[a]===c)return void this._listeners.splice(a,1)}}})),this._event}fire(c,a){const u=[];for(let b=0;b<this._listeners.length;b++)u.push(this._listeners[b]);for(let b=0;b<u.length;b++)u[b].call(void 0,c,a)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},l.forwardEvent=function(c,a){return c(u=>a.fire(u))},l.runAndSubscribe=function(c,a){return a(void 0),c(u=>a(u))}},859:(m,l)=>{function c(a){for(const u of a)u.dispose();a.length=0}Object.defineProperty(l,"__esModule",{value:!0}),l.getDisposeArrayDisposable=l.disposeArray=l.toDisposable=l.MutableDisposable=l.Disposable=void 0,l.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const a of this._disposables)a.dispose();this._disposables.length=0}register(a){return this._disposables.push(a),a}unregister(a){const u=this._disposables.indexOf(a);u!==-1&&this._disposables.splice(u,1)}},l.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(a){this._isDisposed||a===this._value||(this._value?.dispose(),this._value=a)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},l.toDisposable=function(a){return{dispose:a}},l.disposeArray=c,l.getDisposeArrayDisposable=function(a){return{dispose:()=>c(a)}}}},g={};function v(m){var l=g[m];if(l!==void 0)return l.exports;var c=g[m]={exports:{}};return w[m](c,c.exports,v),c.exports}var C={};return(()=>{var m=C;Object.defineProperty(m,"__esModule",{value:!0}),m.SearchAddon=void 0;const l=v(345),c=v(859),a=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class u extends c.Disposable{constructor(e){super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new c.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new c.MutableDisposable,this._onDidChangeResults=this.register(new l.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=e?.highlightLimit??1e3}activate(e){this._terminal=e,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,c.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&this._lastSearchOptions?.decorations&&(this._highlightTimeout=setTimeout(()=>{const e=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(e,{...this._lastSearchOptions,incremental:!0,noScroll:!0})},200))}clearDecorations(e){this._selectedDecoration.clear(),(0,c.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),e||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const s=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,t);this._lastSearchOptions=t,t?.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||s)&&this._highlightAllMatches(e,t);const i=this._findNextAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,i}_highlightAllMatches(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return void this.clearDecorations();t=t||{},this.clearDecorations(!0);const s=[];let i,o=this._find(e,0,0,t);for(;o&&(i?.row!==o.row||i?.col!==o.col)&&!(s.length>=this._highlightLimit);)i=o,s.push(i),o=this._find(e,i.col+i.term.length>=this._terminal.cols?i.row+1:i.row,i.col+i.term.length>=this._terminal.cols?0:i.col+1,t);for(const r of s){const n=this._createResultDecoration(r,t.decorations);n&&(this._highlightedLines.add(n.marker.line),this._highlightDecorations.push({decoration:n,match:r,dispose(){n.dispose()}}))}}_find(e,t,s,i){if(!this._terminal||!e||e.length===0)return this._terminal?.clearSelection(),void this.clearDecorations();if(s>this._terminal.cols)throw new Error(`Invalid col: ${s} to search in terminal of ${this._terminal.cols} cols`);let o;this._initLinesCache();const r={startRow:t,startCol:s};if(o=this._findInLine(e,r,i),!o)for(let n=t+1;n<this._terminal.buffer.active.baseY+this._terminal.rows&&(r.startRow=n,r.startCol=0,o=this._findInLine(e,r,i),!o);n++);return o}_findNextAndSelect(e,t){if(!this._terminal||!e||e.length===0)return this._terminal?.clearSelection(),this.clearDecorations(),!1;const s=this._terminal.getSelectionPosition();this._terminal.clearSelection();let i=0,o=0;s&&(this._cachedSearchTerm===e?(i=s.end.x,o=s.end.y):(i=s.start.x,o=s.start.y)),this._initLinesCache();const r={startRow:o,startCol:i};let n=this._findInLine(e,r,t);if(!n)for(let h=o+1;h<this._terminal.buffer.active.baseY+this._terminal.rows&&(r.startRow=h,r.startCol=0,n=this._findInLine(e,r,t),!n);h++);if(!n&&o!==0)for(let h=0;h<o&&(r.startRow=h,r.startCol=0,n=this._findInLine(e,r,t),!n);h++);return!n&&s&&(r.startRow=s.start.y,r.startCol=0,n=this._findInLine(e,r,t)),this._selectResult(n,t?.decorations,t?.noScroll)}findPrevious(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const s=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,t);this._lastSearchOptions=t,t?.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||s)&&this._highlightAllMatches(e,t);const i=this._findPreviousAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,i}_didOptionsChange(e,t){return!!t&&(e.caseSensitive!==t.caseSensitive||e.regex!==t.regex||e.wholeWord!==t.wholeWord)}_fireResults(e){if(e?.decorations){let t=-1;if(this._selectedDecoration.value){const s=this._selectedDecoration.value.match;for(let i=0;i<this._highlightDecorations.length;i++){const o=this._highlightDecorations[i].match;if(o.row===s.row&&o.col===s.col&&o.size===s.size){t=i;break}}}this._onDidChangeResults.fire({resultIndex:t,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!e||e.length===0)return this._terminal?.clearSelection(),this.clearDecorations(),!1;const s=this._terminal.getSelectionPosition();this._terminal.clearSelection();let i=this._terminal.buffer.active.baseY+this._terminal.rows-1,o=this._terminal.cols;const r=!0;this._initLinesCache();const n={startRow:i,startCol:o};let h;if(s&&(n.startRow=i=s.start.y,n.startCol=o=s.start.x,this._cachedSearchTerm!==e&&(h=this._findInLine(e,n,t,!1),h||(n.startRow=i=s.end.y,n.startCol=o=s.end.x))),h||(h=this._findInLine(e,n,t,r)),!h){n.startCol=Math.max(n.startCol,this._terminal.cols);for(let d=i-1;d>=0&&(n.startRow=d,h=this._findInLine(e,n,t,r),!h);d--);}if(!h&&i!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let d=this._terminal.buffer.active.baseY+this._terminal.rows-1;d>=i&&(n.startRow=d,h=this._findInLine(e,n,t,r),!h);d--);return this._selectResult(h,t?.decorations,t?.noScroll)}_initLinesCache(){const e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._linesCacheDisposables.value=(0,c.getDisposeArrayDisposable)([e.onLineFeed(()=>this._destroyLinesCache()),e.onCursorMove(()=>this._destroyLinesCache()),e.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,t,s){return(e===0||a.includes(t[e-1]))&&(e+s.length===t.length||a.includes(t[e+s.length]))}_findInLine(e,t,s={},i=!1){const o=this._terminal,r=t.startRow,n=t.startCol;if(o.buffer.active.getLine(r)?.isWrapped)return i?void(t.startCol+=o.cols):(t.startRow--,t.startCol+=o.cols,this._findInLine(e,t,s));let d=this._linesCache?.[r];d||(d=this._translateBufferLineToStringWithWrap(r,!0),this._linesCache&&(this._linesCache[r]=d));const[S,D]=d,L=this._bufferColsToStringOffset(r,n),y=s.caseSensitive?e:e.toLowerCase(),T=s.caseSensitive?S:S.toLowerCase();let p=-1;if(s.regex){const f=RegExp(y,"g");let _;if(i)for(;_=f.exec(T.slice(0,L));)p=f.lastIndex-_[0].length,e=_[0],f.lastIndex-=e.length-1;else _=f.exec(T.slice(L)),_&&_[0].length>0&&(p=L+(f.lastIndex-_[0].length),e=_[0])}else i?L-y.length>=0&&(p=T.lastIndexOf(y,L-y.length)):p=T.indexOf(y,L);if(p>=0){if(s.wholeWord&&!this._isWholeWord(p,T,e))return;let f=0;for(;f<D.length-1&&p>=D[f+1];)f++;let _=f;for(;_<D.length-1&&p+e.length>=D[_+1];)_++;const A=p-D[f],M=p+e.length-D[_],O=this._stringLengthToBufferSize(r+f,A);return{term:e,col:O,row:r+f,size:this._stringLengthToBufferSize(r+_,M)-O+o.cols*(_-f)}}}_stringLengthToBufferSize(e,t){const s=this._terminal.buffer.active.getLine(e);if(!s)return 0;for(let i=0;i<t;i++){const o=s.getCell(i);if(!o)break;const r=o.getChars();r.length>1&&(t-=r.length-1);const n=s.getCell(i+1);n&&n.getWidth()===0&&t++}return t}_bufferColsToStringOffset(e,t){const s=this._terminal;let i=e,o=0,r=s.buffer.active.getLine(i);for(;t>0&&r;){for(let n=0;n<t&&n<s.cols;n++){const h=r.getCell(n);if(!h)break;h.getWidth()&&(o+=h.getCode()===0?1:h.getChars().length)}if(i++,r=s.buffer.active.getLine(i),r&&!r.isWrapped)break;t-=s.cols}return o}_translateBufferLineToStringWithWrap(e,t){const s=this._terminal,i=[],o=[0];let r=s.buffer.active.getLine(e);for(;r;){const n=s.buffer.active.getLine(e+1),h=!!n&&n.isWrapped;let d=r.translateToString(!h&&t);if(h&&n){const S=r.getCell(r.length-1);S&&S.getCode()===0&&S.getWidth()===1&&n.getCell(0)?.getWidth()===2&&(d=d.slice(0,-1))}if(i.push(d),!h)break;o.push(o[o.length-1]+d.length),e++,r=n}return[i.join(""),o]}_selectResult(e,t,s){const i=this._terminal;if(this._selectedDecoration.clear(),!e)return i.clearSelection(),!1;if(i.select(e.col,e.row,e.size),t){const o=i.registerMarker(-i.buffer.active.baseY-i.buffer.active.cursorY+e.row);if(o){const r=i.registerDecoration({marker:o,x:e.col,width:e.size,backgroundColor:t.activeMatchBackground,layer:"top",overviewRulerOptions:{color:t.activeMatchColorOverviewRuler}});if(r){const n=[];n.push(o),n.push(r.onRender(h=>this._applyStyles(h,t.activeMatchBorder,!0))),n.push(r.onDispose(()=>(0,c.disposeArray)(n))),this._selectedDecoration.value={decoration:r,match:e,dispose(){r.dispose()}}}}}if(!s&&(e.row>=i.buffer.active.viewportY+i.rows||e.row<i.buffer.active.viewportY)){let o=e.row-i.buffer.active.viewportY;o-=Math.floor(i.rows/2),i.scrollLines(o)}return!0}_applyStyles(e,t,s){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),s&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(e,t){const s=this._terminal,i=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+e.row);if(!i)return;const o=s.registerDecoration({marker:i,x:e.col,width:e.size,backgroundColor:t.matchBackground,overviewRulerOptions:this._highlightedLines.has(i.line)?void 0:{color:t.matchOverviewRuler,position:"center"}});if(o){const r=[];r.push(i),r.push(o.onRender(n=>this._applyStyles(n,t.matchBorder,!1))),r.push(o.onDispose(()=>(0,c.disposeArray)(r)))}return o}}m.SearchAddon=u})(),C})())})(I);var k=I.exports;const E=W({__proto__:null},[k]);export{E as a};
