import{a as t,_ as e,s as a,c as r}from"../chunks/CJLNsLCM.js";import{p as s,o as n,i,f as l,h as o,c as d,e as c,g as v,$ as u,t as m,j as p,k as g,m as f,q as h,r as x,n as b,v as y,x as w,y as k,B as $,D as _,H as C,A as B,I as T,G as V}from"../chunks/CDSotEIi.js";import{C as j}from"../chunks/DGngsJBU.js";import{B as E}from"../chunks/C0CuAnlt.js";var L=l('<div class="mt-3 p-3 bg-red-50 border border-red-200 rounded-md"><p class="text-sm text-red-800"> </p></div>'),M=l('<div class="p-6"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900">Update in Progress</h3> <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"> </span></div> <div class="mb-4"><div class="flex justify-between text-sm text-gray-600 mb-1"><span> </span> <span> </span></div> <div class="w-full bg-gray-200 rounded-full h-2"><div></div></div></div> <p class="text-sm text-gray-600"> </p> <!></div>'),I=l('<div class="mb-6"><!></div>'),P=l('<div class="p-6"><h3 class="text-lg font-medium text-gray-900 mb-4">Current Version</h3> <div class="flex items-center justify-between"><div><p class="text-2xl font-bold text-blue-600"> </p> <p class="text-sm text-gray-600">Currently running</p></div> <div class="flex space-x-2"><!></div></div></div>'),R=l('<div class="mb-6"><!></div>'),z=l('<div class="bg-red-50 border border-red-200 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800">Error</h3> <p class="mt-1 text-sm text-red-700"> </p></div></div></div>'),S=l('<div class="mb-6"><!></div>'),U=l('<div class="text-center py-12"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <p class="mt-2 text-sm text-gray-600">Loading version information...</p></div>'),X=l('<div class="text-sm text-gray-700 bg-gray-50 rounded-md p-3 mb-3"><pre class="whitespace-pre-wrap font-mono text-xs"> </pre></div>'),A=l('<div class="p-6"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center space-x-3 mb-2"><h4 class="text-lg font-semibold text-gray-900"> </h4> <span> </span></div> <h5 class="text-md font-medium text-gray-700 mb-2"> </h5> <div class="text-sm text-gray-600 mb-3"><p> </p></div> <!></div> <div class="flex items-center space-x-2 ml-4"><!> <a target="_blank" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">View on GitHub <svg class="ml-1 w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></a></div></div></div>'),D=l('<div><h3 class="text-lg font-medium text-gray-900 mb-4">Available Versions</h3> <div class="grid grid-cols-1 gap-4"></div></div>'),O=l('<div class="text-center py-12"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <h3 class="mt-2 text-sm font-medium text-gray-900">No updates available</h3> <p class="mt-1 text-sm text-gray-500">You\'re running the latest version of Xanthus.</p></div>'),H=l('<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="mb-8"><h2 class="text-3xl font-bold text-gray-900 mb-2">Version Management</h2> <p class="text-gray-600">Manage platform updates and monitor version status</p></div> <div class="mb-6"><!></div> <!> <!> <!> <!> <!> <!></div>');function N(l,N){s(N,!1);let q=x(null),G=x(null),W=x(!1),F=x(""),Y=null;async function J(){h(W,!0),h(F,"");try{h(q,await t.get("/version/available"))}catch(e){h(F,e instanceof Error?e.message:"Failed to load version information"),console.error("Error loading version info:",e)}finally{h(W,!1)}}async function K(){try{h(G,await t.get("/version/status"))}catch(e){console.error("Error loading update status:",e)}}function Q(){Y&&clearInterval(Y),Y=setInterval(async()=>{await K(),g(G)?.in_progress||(clearInterval(Y),Y=null,await J())},2e3)}async function Z(){try{const{default:s}=await e(async()=>{const{default:t}=await import("../chunks/CT2pLRIc.js");return{default:t}},[],import.meta.url);(await s.fire({title:"Rollback to Previous Version?",html:'\n\t\t\t\t\t<div class="text-left">\n\t\t\t\t\t\t<p class="mb-4">This will rollback Xanthus to the previous version.</p>\n\t\t\t\t\t\t<div class="bg-red-50 border border-red-200 rounded-md p-3">\n\t\t\t\t\t\t\t<p class="text-sm text-red-800">\n\t\t\t\t\t\t\t\t<strong>Warning:</strong> The platform will restart during the rollback process.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p class="mt-3 text-sm text-gray-600">\n\t\t\t\t\t\t\tOnly use this if you\'re experiencing issues with the current version.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t',icon:"warning",showCancelButton:!0,confirmButtonText:"Rollback",cancelButtonText:"Cancel",confirmButtonColor:"#ef4444",showLoaderOnConfirm:!0,preConfirm:async()=>{try{a("Starting rollback...","Please wait while we rollback to the previous version");return await t.post("/version/rollback",{})}catch(e){s.showValidationMessage("Error: "+e.message)}finally{r()}}})).isConfirmed&&(await s.fire({title:"Rollback Started!",text:"Xanthus is rolling back to the previous version. The platform will restart when complete.",icon:"success",confirmButtonColor:"#10b981"}),await K(),g(G)?.in_progress&&Q())}catch(s){console.error("Error triggering rollback:",s)}}function tt(t,e){const a=t=>t.replace(/^v/,"").split(".").map(Number),[r,s,n]=a(t),[i,l,o]=a(e);return r>i||!(r<i)&&(s>l||!(s<l)&&n>o)}n(async()=>(await J(),await K(),g(G)?.in_progress&&Q(),()=>{Y&&clearInterval(Y)})),i();var et=H();o(t=>{u.title="Version Management - Xanthus"});var at=b(f(et),2),rt=f(at);E(rt,{variant:"primary",size:"sm",get disabled(){return g(W)},$$events:{click:J},children:(t,e)=>{y();var a=m();p(()=>w(a,g(W)?"Refreshing...":"Refresh Versions")),c(t,a)},$$slots:{default:!0}}),k(at);var st=b(at,2),nt=t=>{var e=I(),a=f(e);j(a,{children:(t,e)=>{var a=M(),r=f(a),s=b(f(r),2),n=f(s,!0);k(s),k(r);var i=b(r,2),l=f(i),o=f(l),v=f(o);k(o);var u=b(o,2),m=f(u);k(u),k(l);var h=b(l,2),x=f(h);k(h),k(i);var y=b(i,2),B=f(y,!0);k(y);var T=b(y,2),V=t=>{var e=L(),a=f(e),r=f(a,!0);k(a),k(e),p(()=>w(r,g(G).error)),c(t,e)};d(T,t=>{g(G).error&&t(V)}),k(a),p(t=>{w(n,g(G).status),w(v,`Updating to ${g(G).version??""}`),w(m,`${g(G).progress??""}%`),_(x,1,`h-2 rounded-full transition-all duration-300 ${t??""}`),C(x,`width: ${g(G).progress??""}%`),w(B,g(G).message)},[()=>{return(t=g(G).progress)<30?"bg-red-500":t<70?"bg-yellow-500":"bg-green-500";var t}],$),c(t,a)},$$slots:{default:!0}}),k(e),c(t,e)};d(st,t=>{g(G)?.in_progress&&t(nt)});var it=b(st,2),lt=t=>{var e=R(),a=f(e);j(a,{children:(t,e)=>{var a=P(),r=b(f(a),2),s=f(r),n=f(s),i=f(n,!0);k(n),y(2),k(s);var l=b(s,2),o=f(l);const d=$(()=>g(G)?.in_progress);E(o,{variant:"secondary",size:"sm",get disabled(){return g(d)},$$events:{click:Z},children:(t,e)=>{y();var a=m("Rollback");c(t,a)},$$slots:{default:!0}}),k(l),k(r),k(a),p(()=>w(i,g(q).current)),c(t,a)},$$slots:{default:!0}}),k(e),c(t,e)};d(it,t=>{g(q)&&t(lt)});var ot=b(it,2),dt=t=>{var e=S(),a=f(e);j(a,{children:(t,e)=>{var a=z(),r=f(a),s=b(f(r),2),n=b(f(s),2),i=f(n,!0);k(n),k(s),k(r),k(a),p(()=>w(i,g(F))),c(t,a)},$$slots:{default:!0}}),k(e),c(t,e)};d(ot,t=>{g(F)&&t(dt)});var ct=b(ot,2),vt=t=>{var e=U();c(t,e)};d(ct,t=>{g(W)&&t(vt)});var ut=b(ct,2),mt=s=>{var n=D(),i=b(f(n),2);B(i,5,()=>g(q).available,V,(s,n)=>{j(s,{children:(s,i)=>{var l=A(),o=f(l),v=f(o),u=f(v),h=f(u),x=f(h,!0);k(h);var C=b(h,2),B=f(C,!0);k(C),k(u);var V=b(u,2),j=f(V,!0);k(V);var L=b(V,2),M=f(L),I=f(M);k(M),k(L);var P=b(L,2),R=t=>{var e=X(),a=f(e),r=f(a,!0);k(a),k(e),p(()=>w(r,g(n).body)),c(t,e)};d(P,t=>{g(n).body&&t(R)}),k(v);var z=b(v,2),S=f(z),U=s=>{const i=$(()=>tt(g(n).tag_name,g(q).current)?"primary":"secondary"),l=$(()=>g(G)?.in_progress);E(s,{get variant(){return g(i)},size:"sm",get disabled(){return g(l)},$$events:{click:()=>async function(s){try{const{default:n}=await e(async()=>{const{default:t}=await import("../chunks/CT2pLRIc.js");return{default:t}},[],import.meta.url);(await n.fire({title:`Update to ${s}?`,html:`\n\t\t\t\t\t<div class="text-left">\n\t\t\t\t\t\t<p class="mb-4">This will update Xanthus to version <strong>${s}</strong>.</p>\n\t\t\t\t\t\t<div class="bg-yellow-50 border border-yellow-200 rounded-md p-3">\n\t\t\t\t\t\t\t<p class="text-sm text-yellow-800">\n\t\t\t\t\t\t\t\t<strong>Warning:</strong> The platform will restart during the update process. This may take a few minutes.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p class="mt-3 text-sm text-gray-600">\n\t\t\t\t\t\t\tThe previous version will be available for rollback if needed.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t`,icon:"question",showCancelButton:!0,confirmButtonText:"Start Update",cancelButtonText:"Cancel",confirmButtonColor:"#3b82f6",showLoaderOnConfirm:!0,preConfirm:async()=>{try{return a("Starting update...","Please wait while we prepare the update"),await t.post("/version/update",{version:s})}catch(e){n.showValidationMessage("Error: "+e.message)}finally{r()}}})).isConfirmed&&(await n.fire({title:"Update Started!",text:`Xanthus is updating to ${s}. The platform will restart when complete.`,icon:"success",confirmButtonColor:"#10b981"}),await K(),g(G)?.in_progress&&Q())}catch(n){console.error("Error triggering update:",n)}}(g(n).tag_name)},children:(t,e)=>{y();var a=m();p(t=>w(a,t),[()=>tt(g(n).tag_name,g(q).current)?"Update":"Install"],$),c(t,a)},$$slots:{default:!0}})};d(S,t=>{g(n).tag_name===g(q).current||g(n).draft||t(U)});var D=b(S,2);k(z),k(o),k(l),p((t,e,a)=>{w(x,g(n).tag_name),_(C,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t??""}`),w(B,e),w(j,g(n).name),w(I,`Published: ${a??""}`),T(D,"href",g(n).html_url)},[()=>function(t){return t.prerelease?"bg-yellow-100 text-yellow-800":g(q)&&tt(t.tag_name,g(q).current)?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}(g(n)),()=>function(t){return t.prerelease?"Pre-release":g(q)&&tt(t.tag_name,g(q).current)?"Newer":g(q)&&t.tag_name===g(q).current?"Current":"Available"}(g(n)),()=>{return t=g(n).published_at,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});var t}],$),c(s,l)},$$slots:{default:!0}})}),k(i),k(n),c(s,n)};d(ut,t=>{!g(W)&&g(q)&&g(q).available.length>0&&t(mt)});var pt=b(ut,2),gt=t=>{var e=O();c(t,e)};d(pt,t=>{g(W)||!g(q)||0!==g(q).available.length||g(F)||t(gt)}),k(et),c(l,et),v()}export{N as component};
