import{_ as U}from"../chunks/CmsKOCeN.js";import"../chunks/CWj6FrbW.js";import"../chunks/RaIwcHWQ.js";import{o as ze}from"../chunks/ChR5l_r1.js";import{at as Me,aa as Pe,p as Re,l as ae,k as ke,m as g,C as Ve,n as d,o as Fe,$ as je,B as R,t as H,g as t,w as u,s as K,v as I,y as f,A as k,z as E,x as l,u as p,E as Oe,h as se,as as Xe}from"../chunks/Ce1HVTUQ.js";import{i as _,s as Ne,a as oe}from"../chunks/C18abfhG.js";import{C as q,e as Ze,i as Ue}from"../chunks/C0w9dAzy.js";import{s as He}from"../chunks/bgO99CsW.js";import{i as Ke}from"../chunks/BdY6-5Q-.js";import{a as ie,s as ne,c as le}from"../chunks/BJkf_VXN.js";import{B as V}from"../chunks/BZ4NpD64.js";const Ie={domains:[],loading:!1,error:null,filters:{managed:"all",status:"all",search:""},sort:{field:"name",direction:"asc"}},z=Pe(Ie),qe=Me(z,i=>{let e=[...i.domains];if(i.filters.managed!=="all"&&(e=e.filter(a=>i.filters.managed==="managed"?a.managed:i.filters.managed==="unmanaged"?!a.managed:!0)),i.filters.status!=="all"&&(e=e.filter(a=>a.status===i.filters.status)),i.filters.search){const a=i.filters.search.toLowerCase();e=e.filter(v=>v.name.toLowerCase().includes(a)||v.status.toLowerCase().includes(a)||v.type.toLowerCase().includes(a))}return e.sort((a,v)=>{let c=a[i.sort.field],w=v[i.sort.field];(i.sort.field==="created_on"||i.sort.field==="modified_on")&&(c=new Date(c),w=new Date(w)),typeof c=="string"&&typeof w=="string"&&(c=c.toLowerCase(),w=w.toLowerCase());let m=0;return c>w?m=1:c<w&&(m=-1),i.sort.direction==="desc"?-m:m}),e}),Ye=i=>{z.update(e=>({...e,domains:i,loading:!1,error:null}))},We=i=>{z.update(e=>({...e,loading:i}))},ce=i=>{z.update(e=>({...e,error:i,loading:!1}))};class Ge{async fetchDomains(){try{return(await ie.get("/dns/list")).domains||[]}catch(e){throw console.error("Error fetching domains:",e),new Error("Failed to fetch domains")}}async configureDomain(e){try{const a=new FormData;a.append("domain",e);const v=await fetch("/dns/configure",{method:"POST",body:a}),c=await v.json();if(!v.ok)throw new Error(c.error||"Configuration failed");return{success:!0,message:c.message||"SSL configuration completed successfully",config:c.config}}catch(a){throw console.error("Error configuring domain:",a),new Error(a instanceof Error?a.message:"Failed to configure domain")}}async removeDomain(e){try{const a=new FormData;a.append("domain",e);const v=await fetch("/dns/remove",{method:"POST",body:a}),c=await v.json();if(!v.ok)throw new Error(c.error||"Removal failed");return{success:!0,message:c.message||"Domain configuration removed successfully"}}catch(a){throw console.error("Error removing domain:",a),new Error(a instanceof Error?a.message:"Failed to remove domain")}}async getDomainConfiguration(e){try{return await ie.get(`/dns/config/${e}`)}catch(a){throw console.error("Error fetching domain configuration:",a),new Error("Failed to fetch domain configuration")}}validateDomainName(e){return/^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9](?:\.[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])*$/.test(e)}getStatusBadgeClass(e){switch(e.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"error":case"failed":return"bg-red-100 text-red-800";case"paused":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}}formatDate(e){try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return e}}formatDateTime(e){try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}getDomainTypeDisplay(e){switch(e.toLowerCase()){case"full":return"Full Zone";case"partial":return"Partial Zone";default:return e}}isDomainReady(e){return e.managed&&e.status==="active"&&!e.paused}getManagementStatusText(e){return e.managed?"Managed by Xanthus":"Not Managed"}getAvailableActions(e){const a=[];return e.managed?(a.push("view-config"),a.push("remove")):a.push("configure"),a}}const b=new Ge;var Je=g('<div class="bg-blue-50 border border-blue-200 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-blue-800">Domain Management</h3> <div class="mt-2 text-sm text-blue-700"><p>Below are all domains registered in your Cloudflare account. Domains marked as "Managed by Xanthus" are configured for K3s deployment.</p></div></div></div></div>'),Qe=g('<div class="mb-6"><!></div>'),et=g('<div class="bg-red-50 border border-red-200 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800">Error</h3> <p class="mt-1 text-sm text-red-700"> </p></div></div></div>'),tt=g('<div class="mb-6"><!></div>'),rt=g('<div class="text-center py-12"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <p class="mt-2 text-sm text-gray-600">Loading domains...</p></div>'),at=g('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Managed by Xanthus</span>'),st=g('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600">Not Managed</span>'),ot=g('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg> Paused</span>'),it=g("<!> <!>",1),nt=g('<div class="flex items-center justify-between p-6"><div class="flex-1"><div class="flex items-center space-x-3"><h3 class="text-lg font-semibold text-gray-900"> </h3> <span><svg class="w-2 h-2 mr-1 fill-current" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3"></circle></svg> </span> <!> <!></div> <div class="mt-2 text-sm text-gray-600"><p> </p> <p> </p></div></div> <div class="flex items-center space-x-2"><!></div></div>'),lt=g('<div class="grid grid-cols-1 gap-4"></div>'),ct=g('<div class="text-center py-12"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <h3 class="mt-2 text-sm font-medium text-gray-900">No domains found</h3> <p class="mt-1 text-sm text-gray-500">No domains are registered in your Cloudflare account.</p> <div class="mt-6"><a href="https://dash.cloudflare.com/" target="_blank" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Add Domain to Cloudflare</a></div></div>'),dt=g('<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="mb-8"><h2 class="text-3xl font-bold text-gray-900 mb-2">DNS Configuration</h2> <p class="text-gray-600">Manage your Cloudflare domains and SSL certificates</p></div> <div class="mb-6"><!></div> <!> <!> <!> <!> <!></div>');function bt(i,e){Re(e,!1);const[a,v]=Ne(),c=()=>oe(z,"$dnsStore",a),w=()=>oe(qe,"$filteredDomains",a),m=I(),C=I(),y=I();ze(async()=>{await M()});async function M(){We(!0),ce(null);try{const r=await b.fetchDomains();Ye(r)}catch(r){ce(r instanceof Error?r.message:"Failed to load domains"),console.error("Error loading domains:",r)}}async function de(r){try{const{default:o}=await U(async()=>{const{default:s}=await import("../chunks/0MHz4Was.js");return{default:s}},[],import.meta.url);(await o.fire({title:`Configure SSL for ${r.name}`,html:`
					<div class="text-left">
						<p class="mb-4">This will automatically configure:</p>
						<ul class="list-disc list-inside space-y-2 text-sm">
							<li>SSL/TLS mode to Full (strict)</li>
							<li>Create Origin Server Certificate</li>
							<li>Append Cloudflare Root CA</li>
							<li>Enable Always Use HTTPS</li>
							<li>Create www redirect page rule</li>
						</ul>
						<p class="mt-4 text-sm text-gray-600">The certificates will be stored in Cloudflare KV for K8s deployment.</p>
					</div>
				`,icon:"question",showCancelButton:!0,confirmButtonText:"Configure SSL",cancelButtonText:"Cancel",confirmButtonColor:"#3b82f6",showLoaderOnConfirm:!0,preConfirm:async()=>{try{return ne("Configuring SSL...","Please wait while we configure SSL for your domain"),await b.configureDomain(r.name)}catch(s){o.showValidationMessage("Error: "+s.message)}finally{le()}}})).isConfirmed&&(await o.fire({title:"Success!",text:`SSL configuration completed for ${r.name}`,icon:"success",confirmButtonColor:"#10b981"}),await M())}catch(o){console.error("Error configuring domain:",o)}}async function ue(r){try{const{default:o}=await U(async()=>{const{default:s}=await import("../chunks/0MHz4Was.js");return{default:s}},[],import.meta.url);(await o.fire({title:`Remove ${r.name} from Xanthus?`,html:`
					<div class="text-left">
						<p class="mb-4">This will completely revert all Cloudflare changes made by Xanthus:</p>
						<ul class="list-disc list-inside space-y-2 text-sm text-red-600">
							<li>Delete origin server certificate</li>
							<li>Remove www redirect page rules</li>
							<li>Reset SSL mode to Flexible</li>
							<li>Disable Always Use HTTPS</li>
							<li>Remove configuration from Xanthus storage</li>
						</ul>
						<div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-md">
							<p class="text-sm text-amber-800">
								<strong>Warning:</strong> Your domain will return to its original Cloudflare state before Xanthus management.
							</p>
						</div>
					</div>
				`,icon:"warning",showCancelButton:!0,confirmButtonText:"Remove & Revert All",cancelButtonText:"Cancel",confirmButtonColor:"#ef4444",showLoaderOnConfirm:!0,preConfirm:async()=>{try{return ne("Removing domain...","Please wait while we revert all changes"),await b.removeDomain(r.name)}catch(s){o.showValidationMessage("Error: "+s.message)}finally{le()}}})).isConfirmed&&(await o.fire({title:"Successfully Removed!",html:`
						<div class="text-center">
							<p class="mb-3">All Cloudflare changes have been reverted for <strong>${r.name}</strong></p>
							<p class="text-sm text-gray-600">Your domain has been restored to its original Cloudflare configuration.</p>
						</div>
					`,icon:"success",confirmButtonColor:"#10b981"}),await M())}catch(o){console.error("Error removing domain:",o)}}async function fe(r){try{const{default:o}=await U(async()=>{const{default:h}=await import("../chunks/0MHz4Was.js");return{default:h}},[],import.meta.url);await o.fire({title:`Configuration for ${r.name}`,html:`
					<div class="text-left">
						<div class="space-y-3">
							<div class="flex justify-between">
								<span class="font-medium">SSL Mode:</span>
								<span class="text-green-600">Full (strict)</span>
							</div>
							<div class="flex justify-between">
								<span class="font-medium">Origin Certificate:</span>
								<span class="text-green-600">✓ Created</span>
							</div>
							<div class="flex justify-between">
								<span class="font-medium">Always Use HTTPS:</span>
								<span class="text-green-600">✓ Enabled</span>
							</div>
							<div class="flex justify-between">
								<span class="font-medium">Page Rule:</span>
								<span class="text-green-600">✓ www redirect</span>
							</div>
							<div class="flex justify-between">
								<span class="font-medium">Certificates:</span>
								<span class="text-green-600">✓ Stored in KV</span>
							</div>
						</div>
						<div class="mt-4 p-3 bg-blue-50 rounded-md">
							<p class="text-sm text-blue-800">
								SSL certificates are ready for K8s deployment. They will be automatically applied when you deploy your application.
							</p>
						</div>
					</div>
				`,icon:"info",confirmButtonText:"Close",confirmButtonColor:"#3b82f6"})}catch(o){console.error("Error viewing configuration:",o)}}ae(()=>(t(m),t(C),c()),()=>{(r=>{K(m,r.loading),K(C,r.error)})(c())}),ae(()=>w(),()=>{K(y,w())}),ke(),Ke();var F=dt();Ve(r=>{je.title="DNS Configuration - Xanthus"});var j=f(u(F),2),me=u(j);V(me,{variant:"primary",size:"sm",get disabled(){return t(m)},$$events:{click:M},children:(r,o)=>{k();var h=R();H(()=>E(h,t(m)?"Refreshing...":"Refresh Domains")),d(r,h)},$$slots:{default:!0}}),l(j);var Y=f(j,2);{var ve=r=>{var o=Qe(),h=u(o);q(h,{children:(s,O)=>{var D=Je();d(s,D)},$$slots:{default:!0}}),l(o),d(r,o)};_(Y,r=>{t(y),p(()=>t(y).length>0)&&r(ve)})}var W=f(Y,2);{var pe=r=>{var o=tt(),h=u(o);q(h,{children:(s,O)=>{var D=et(),$=u(D),S=f(u($),2),L=f(u(S),2),T=u(L,!0);l(L),l(S),l($),l(D),H(()=>E(T,t(C))),d(s,D)},$$slots:{default:!0}}),l(o),d(r,o)};_(W,r=>{t(C)&&r(pe)})}var G=f(W,2);{var ge=r=>{var o=rt();d(r,o)};_(G,r=>{t(m)&&r(ge)})}var J=f(G,2);{var he=r=>{var o=lt();Ze(o,5,()=>t(y),Ue,(h,s)=>{q(h,{children:(O,D)=>{var $=nt(),S=u($),L=u(S),T=u(L),ye=u(T,!0);l(T);var P=f(T,2),_e=f(u(P));l(P);var Q=f(P,2);{var be=n=>{var x=at();d(n,x)},Ce=n=>{var x=st();d(n,x)};_(Q,n=>{t(s),p(()=>t(s).managed)?n(be):n(Ce,!1)})}var De=f(Q,2);{var $e=n=>{var x=ot();d(n,x)};_(De,n=>{t(s),p(()=>t(s).paused)&&n($e)})}l(L);var ee=f(L,2),X=u(ee),Se=u(X);l(X);var te=f(X,2),Le=u(te);l(te),l(ee),l(S);var re=f(S,2),Ee=u(re);{var Te=n=>{var x=it(),B=Xe(x);V(B,{variant:"secondary",size:"sm",$$events:{click:()=>fe(t(s))},children:(N,Ae)=>{k();var Z=R("View Config");d(N,Z)},$$slots:{default:!0}});var A=f(B,2);V(A,{variant:"danger",size:"sm",$$events:{click:()=>ue(t(s))},children:(N,Ae)=>{k();var Z=R("Remove");d(N,Z)},$$slots:{default:!0}}),d(n,x)},Be=n=>{V(n,{variant:"primary",size:"sm",$$events:{click:()=>de(t(s))},children:(x,B)=>{k();var A=R("Add to Xanthus");d(x,A)},$$slots:{default:!0}})};_(Ee,n=>{t(s),p(()=>t(s).managed)?n(Te):n(Be,!1)})}l(re),l($),H((n,x,B,A)=>{E(ye,(t(s),p(()=>t(s).name))),He(P,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n??""}`),E(_e,` ${x??""}`),E(Se,`Type: ${t(s),p(()=>t(s).type)??""} | ID: ${t(s),p(()=>t(s).id)??""}`),E(Le,`Created: ${B??""} | Modified: ${A??""}`)},[()=>(t(s),p(()=>getStatusBadgeClass(t(s).status))),()=>(t(s),p(()=>t(s).status.charAt(0).toUpperCase()+t(s).status.slice(1))),()=>(se(b),t(s),p(()=>b.formatDate(t(s).created_on))),()=>(se(b),t(s),p(()=>b.formatDate(t(s).modified_on)))],Oe),d(O,$)},$$slots:{default:!0}})}),l(o),d(r,o)};_(J,r=>{t(m),t(y),p(()=>!t(m)&&t(y).length>0)&&r(he)})}var xe=f(J,2);{var we=r=>{var o=ct();d(r,o)};_(xe,r=>{t(m),t(y),t(C),p(()=>!t(m)&&t(y).length===0&&!t(C))&&r(we)})}l(F),d(i,F),Fe(),v()}export{bt as component};
