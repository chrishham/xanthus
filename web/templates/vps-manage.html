<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xanthus - VPS Management</title>
    <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
    <link rel="stylesheet" href="/static/css/output.css">
    <link rel="stylesheet" href="/static/css/sweetalert2.min.css">
    <script src="/static/js/vendor/htmx.min.js"></script>
    <script src="/static/js/vendor/alpine.min.js" defer></script>
    <script src="/static/js/vendor/sweetalert2.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    {{template "navbar.html" .}}

    <div x-data="vpsManagement()" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Loading Modal -->
        <div x-show="loading" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl p-8 max-w-md mx-4">
                <div class="text-center">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2" x-text="loadingTitle">Processing...</h3>
                    <p class="text-gray-600" x-text="loadingMessage">Please wait while the operation completes.</p>
                </div>
            </div>
        </div>
        <!-- Header -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">VPS Management</h2>
            <p class="text-gray-600">Manage your Hetzner VPS instances for K3s deployment</p>
        </div>


        <!-- Action Buttons -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex space-x-3">
                <button @click="refreshServers()" 
                        :disabled="loading"
                        class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50">
                    <svg class="w-4 h-4 mr-2" :class="{'animate-spin': loading}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
                <button @click="toggleAutoRefresh()" 
                        class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                        :class="{'bg-green-50 border-green-300 text-green-700': autoRefreshEnabled}">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span x-text="autoRefreshEnabled ? 'Auto-refresh ON' : 'Auto-refresh OFF'"></span>
                </button>
                <a href="/vps/create" 
                   class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create New VPS
                </a>
            </div>
            <div x-show="autoRefreshEnabled" class="text-sm text-gray-500">
                <span x-text="'Auto-refreshing every ' + (getAdaptiveInterval() / 1000) + ' seconds'"></span>
                <span x-show="adaptivePolling && servers.some(s => ['initializing', 'starting', 'stopping'].includes(s.status))" 
                      class="text-blue-600 font-medium">
                    (fast mode)
                </span>
            </div>
        </div>


        <!-- No Servers State -->
        <div x-show="servers.length === 0 && !loading" class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path>
            </svg>
            <h3 class="mt-2 text-lg font-medium text-gray-900">No VPS instances found</h3>
            <p class="mt-1 text-gray-500">Get started by creating your first VPS instance.</p>
            <div class="mt-6">
                <a href="/vps/create" 
                   class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create VPS
                </a>
            </div>
        </div>

        <!-- Servers Grid -->
        <div x-show="servers.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="server in servers" :key="server.id">
                <div class="bg-white rounded-lg shadow-md border hover:shadow-lg transition-shadow">
                    <!-- Server Header -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900" x-text="server.name"></h3>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                  :class="{
                                      'bg-green-100 text-green-800': server.status === 'running',
                                      'bg-yellow-100 text-yellow-800': server.status === 'initializing',
                                      'bg-red-100 text-red-800': server.status === 'off',
                                      'bg-gray-100 text-gray-800': !['running', 'initializing', 'off'].includes(server.status)
                                  }"
                                  x-text="server.status">
                            </span>
                        </div>
                        <p class="text-sm text-gray-500 mt-1" x-text="'ID: ' + server.id"></p>
                    </div>

                    <!-- Server Details -->
                    <div class="p-6">
                        <div class="space-y-3">
                            <!-- Server Type -->
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">Server Type:</span>
                                <span class="text-sm font-medium text-gray-900" x-text="server.server_type.name"></span>
                            </div>
                            
                            <!-- Location -->
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">Location:</span>
                                <span class="text-sm font-medium text-gray-900" x-text="server.datacenter.location.description"></span>
                            </div>
                            
                            <!-- Resources -->
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">Resources:</span>
                                <span class="text-sm font-medium text-gray-900" 
                                      x-text="server.server_type.cores + ' CPU, ' + server.server_type.memory + 'GB RAM'"></span>
                            </div>
                            
                            <!-- Public IP -->
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">Public IP:</span>
                                <span class="text-sm font-medium text-gray-900 font-mono" x-text="server.public_net.ipv4.ip"></span>
                            </div>
                            
                            <!-- SSL Status -->
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">SSL Config:</span>
                                <span class="text-xs px-2 py-1 rounded-full"
                                      :class="server.labels && server.labels.managed_by === 'xanthus' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                                      x-text="server.labels && server.labels.managed_by === 'xanthus' ? 'Configured' : 'Not configured'">
                                </span>
                            </div>

                            <!-- SSH Access -->
                            <div x-show="server.labels && server.labels.managed_by === 'xanthus'" class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">SSH Access:</span>
                                <span class="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                                    Available
                                </span>
                            </div>
                            
                            <!-- Cost Information -->
                            <div x-show="server.labels && server.labels.monthly_cost" class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-sm text-gray-500">Monthly Cost:</span>
                                    <button @click="showCostInfo()" class="ml-1 text-gray-400 hover:text-gray-600 focus:outline-none" title="Cost Information">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                                        </svg>
                                    </button>
                                </div>
                                <span class="text-sm font-medium text-green-600" x-text="'‚Ç¨' + server.labels.monthly_cost + '/mo'"></span>
                            </div>
                            
                            <div x-show="server.labels && server.labels.accumulated_cost" class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-sm text-gray-500">Accumulated Cost:</span>
                                    <button @click="showAccumulatedCostInfo(server)" class="ml-1 text-gray-400 hover:text-gray-600 focus:outline-none" title="Accumulated Cost Information">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                                        </svg>
                                    </button>
                                </div>
                                <span class="text-sm font-medium text-blue-600" x-text="'‚Ç¨' + server.labels.accumulated_cost"></span>
                            </div>
                            
                            <!-- Hourly Rate -->
                            <div x-show="server.labels && server.labels.hourly_cost" class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-sm text-gray-500">Hourly Rate:</span>
                                    <button @click="showHourlyRateInfo()" class="ml-1 text-gray-400 hover:text-gray-600 focus:outline-none" title="Hourly Rate Information">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                                        </svg>
                                    </button>
                                </div>
                                <span class="text-sm font-medium text-orange-600" x-text="'‚Ç¨' + server.labels.hourly_cost + '/hr'"></span>
                            </div>
                            
                            <!-- Created -->
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">Created:</span>
                                <span class="text-sm font-medium text-gray-900" x-text="formatDate(server.created)"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg">
                        <!-- SSH Connection Info (for Xanthus-managed servers) -->
                        <div x-show="server.labels && server.labels.managed_by === 'xanthus'" class="mb-3 p-2 bg-blue-50 rounded-md">
                            <div class="text-xs font-medium text-blue-900 mb-1">SSH Connection:</div>
                            <div class="text-xs text-blue-800 font-mono mb-2">
                                ssh -i xanthus-key.pem root@<span x-text="server.public_net.ipv4.ip"></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click="downloadSSHKey()" 
                                        class="text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    üì• Download SSH Key
                                </button>
                                <button @click="showSSHInstructions()" 
                                        class="text-xs px-2 py-1 border border-blue-300 text-blue-700 rounded hover:bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    ‚ÑπÔ∏è SSH Setup
                                </button>
                            </div>
                        </div>

                        <!-- Advanced Actions (for Xanthus-managed servers) -->
                        <div x-show="server.labels && server.labels.managed_by === 'xanthus'" class="mb-3">
                            <div class="flex space-x-2 mb-2">
                                <button @click="checkVPSStatus(server.id)" 
                                        class="flex-1 text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-1 focus:ring-green-500">
                                    üîç Health Check
                                </button>
                                <button @click="showVPSLogs(server.id)" 
                                        class="flex-1 text-xs px-2 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 focus:outline-none focus:ring-1 focus:ring-purple-500">
                                    üìù View Logs
                                </button>
                                <button @click="showConfigureVPS(server.id)" 
                                        class="flex-1 text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    ‚öôÔ∏è Configure
                                </button>
                            </div>
                            <div class="flex space-x-2 mb-2">
                                <button @click="openTerminal(server.id, server.name)" 
                                        class="flex-1 text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-1 focus:ring-green-500">
                                    üñ•Ô∏è Terminal
                                </button>
                                <button @click="openTerminalNewTab(server.id, server.name)" 
                                        class="flex-1 text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-1 focus:ring-green-500">
                                    üì± New Tab
                                </button>
                            </div>
                        </div>

                        <div class="flex space-x-2">
                            <!-- Power Actions -->
                            <template x-if="server.status === 'running'">
                                <button @click="powerOffServer(server.id, server.name)" 
                                        class="flex-1 text-xs px-3 py-2 border border-orange-300 text-orange-700 bg-orange-50 rounded-md hover:bg-orange-100 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    Power Off
                                </button>
                            </template>
                            <template x-if="server.status === 'off'">
                                <button @click="powerOnServer(server.id, server.name)" 
                                        class="flex-1 text-xs px-3 py-2 border border-green-300 text-green-700 bg-green-50 rounded-md hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-500">
                                    Power On
                                </button>
                            </template>
                            <template x-if="server.status === 'running'">
                                <button @click="rebootServer(server.id, server.name)" 
                                        class="flex-1 text-xs px-3 py-2 border border-blue-300 text-blue-700 bg-blue-50 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    Reboot
                                </button>
                            </template>
                            
                            <!-- Delete -->
                            <button @click="confirmDeleteServer(server.id, server.name)" 
                                    class="flex-1 text-xs px-3 py-2 border border-red-300 text-red-700 bg-red-50 rounded-md hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
        function vpsManagement() {
            return {
                servers: {{.Servers | toJSON}},
                loading: false,
                loadingTitle: 'Processing...',
                loadingMessage: 'Please wait while the operation completes.',
                autoRefreshEnabled: true,
                refreshInterval: 10000, // 10 seconds - faster for better UX
                intervalId: null,
                adaptivePolling: true,

                init() {
                    // Start automatic refresh
                    this.startAutoRefresh();
                    
                    // Stop polling when page is hidden/unfocused
                    document.addEventListener('visibilitychange', () => {
                        if (document.hidden) {
                            this.stopAutoRefresh();
                        } else {
                            this.startAutoRefresh();
                            // Refresh immediately when page becomes visible
                            this.refreshServersQuietly();
                        }
                    });
                },

                startAutoRefresh() {
                    if (this.autoRefreshEnabled && !this.intervalId) {
                        this.intervalId = setInterval(() => {
                            this.refreshServersQuietly();
                        }, this.getAdaptiveInterval());
                    }
                },

                getAdaptiveInterval() {
                    if (!this.adaptivePolling) {
                        return this.refreshInterval;
                    }
                    
                    // Check if any servers are in transitional states
                    const transitionalStates = ['initializing', 'starting', 'stopping'];
                    const hasTransitionalServers = this.servers.some(server => 
                        transitionalStates.includes(server.status)
                    );
                    
                    // Use faster polling (5 seconds) when servers are transitioning
                    return hasTransitionalServers ? 5000 : this.refreshInterval;
                },

                restartAutoRefreshWithNewInterval() {
                    if (this.autoRefreshEnabled) {
                        this.stopAutoRefresh();
                        this.startAutoRefresh();
                    }
                },

                stopAutoRefresh() {
                    if (this.intervalId) {
                        clearInterval(this.intervalId);
                        this.intervalId = null;
                    }
                },

                toggleAutoRefresh() {
                    this.autoRefreshEnabled = !this.autoRefreshEnabled;
                    if (this.autoRefreshEnabled) {
                        this.startAutoRefresh();
                    } else {
                        this.stopAutoRefresh();
                    }
                },

                async refreshServersQuietly() {
                    // Refresh without showing loading spinner
                    try {
                        const response = await fetch('/vps/list', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const oldServers = this.servers;
                            this.servers = data.servers || [];
                            
                            // Check if we need to adjust polling interval
                            if (this.adaptivePolling) {
                                const oldHasTransitional = oldServers.some(s => 
                                    ['initializing', 'starting', 'stopping'].includes(s.status)
                                );
                                const newHasTransitional = this.servers.some(s => 
                                    ['initializing', 'starting', 'stopping'].includes(s.status)
                                );
                                
                                // Restart with new interval if transitional state changed
                                if (oldHasTransitional !== newHasTransitional) {
                                    this.restartAutoRefreshWithNewInterval();
                                }
                            }
                        }
                    } catch (error) {
                        console.log('Background refresh failed:', error);
                        // Silently fail for background updates
                    }
                },

                async refreshServers() {
                    this.setLoadingState('Refreshing Servers', 'Loading server list...');
                    try {
                        const response = await fetch('/vps/list', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.servers = data.servers || [];
                        } else {
                            console.error('Failed to refresh servers');
                            Swal.fire('Error', 'Failed to refresh server list', 'error');
                        }
                    } catch (error) {
                        console.error('Error refreshing servers:', error);
                        Swal.fire('Error', 'Failed to refresh server list', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async showCreateServerModal() {
                    // First, load server options
                    try {
                        const response = await fetch('/vps/server-options');
                        const data = await response.json();
                        
                        if (!response.ok) {
                            throw new Error(data.error || 'Failed to load server options');
                        }
                        
                        const { locations, serverTypes } = data;
                        
                        // Build location options
                        const locationOptions = locations.map(loc => 
                            `<option value="${loc.name}">${loc.description} (${loc.name})</option>`
                        ).join('');
                        
                        // Build server type options with monthly pricing
                        const serverTypeOptions = serverTypes.map(type => {
                            const hourlyPrice = parseFloat(type.prices.find(p => p.location === 'nbg1' && p.price_hourly).price_hourly.net);
                            const monthlyPrice = (hourlyPrice * 24 * 30).toFixed(2); // 30 days approximation
                            return `<option value="${type.name}">${type.name} - ${type.cores} vCPU, ${type.memory}GB RAM, ${type.disk}GB SSD - ‚Ç¨${monthlyPrice}/month</option>`;
                        }).join('');
                        
                        const { value: formValues } = await Swal.fire({
                            title: 'Create New VPS',
                            html: `
                                <div class="text-left space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Server Name</label>
                                        <input id="server-name" class="swal2-input w-full" placeholder="my-k3s-server" value="xanthus-k3s-${Date.now()}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                        <select id="server-location" class="swal2-select w-full">
                                            <option value="">Select a location</option>
                                            ${locationOptions}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Server Type</label>
                                        <select id="server-type" class="swal2-select w-full">
                                            <option value="">Select a server type</option>
                                            ${serverTypeOptions}
                                        </select>
                                    </div>
                                    <div class="p-3 bg-blue-50 rounded-md text-sm">
                                        <strong>OS:</strong> Ubuntu 24.04 LTS<br>
                                        <strong>K3s:</strong> Auto-installed with SSL<br>
                                        <strong>SSL:</strong> Cloudflare certificates included<br>
                                        <strong>SSH:</strong> RSA key authentication
                                    </div>
                                    <div class="p-3 bg-amber-50 border border-amber-200 rounded-md text-sm">
                                        <div class="flex items-start">
                                            <svg class="h-4 w-4 text-amber-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <strong class="text-amber-800">Additional Costs:</strong><br>
                                                <span class="text-amber-700">IPv4 address: ‚Ç¨0.50/month (required for internet access)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `,
                            showCancelButton: true,
                            confirmButtonText: 'Create VPS',
                            confirmButtonColor: '#2563eb',
                            preConfirm: () => {
                                const name = document.getElementById('server-name').value;
                                const location = document.getElementById('server-location').value;
                                const serverType = document.getElementById('server-type').value;
                                
                                if (!name) {
                                    Swal.showValidationMessage('Server name is required');
                                    return false;
                                }
                                if (!location) {
                                    Swal.showValidationMessage('Location is required');
                                    return false;
                                }
                                if (!serverType) {
                                    Swal.showValidationMessage('Server type is required');
                                    return false;
                                }
                                
                                return { name, location, serverType };
                            }
                        });

                        if (formValues) {
                            await this.createServer(formValues.name, formValues.location, formValues.serverType);
                        }
                    } catch (error) {
                        console.error('Error loading server options:', error);
                        Swal.fire('Error', 'Failed to load server options. Please check your Hetzner API key configuration.', 'error');
                    }
                },

                async createServer(name, location, serverType) {
                    this.setLoadingState('Creating VPS', `Creating VPS "${name}"...`);
                    try {
                        const response = await fetch('/vps/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: `name=${encodeURIComponent(name)}&location=${encodeURIComponent(location)}&server_type=${encodeURIComponent(serverType)}`
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            Swal.fire({
                                title: 'Success!',
                                text: `VPS "${name}" is being created. This may take a few minutes.`,
                                icon: 'success',
                                confirmButtonColor: '#2563eb'
                            });
                            await this.refreshServers();
                        } else {
                            Swal.fire('Error', data.error || 'Failed to create VPS', 'error');
                        }
                    } catch (error) {
                        console.error('Error creating server:', error);
                        Swal.fire('Error', 'Failed to create VPS', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async confirmDeleteServer(serverId, serverName) {
                    const result = await Swal.fire({
                        title: 'Delete VPS?',
                        text: `Are you sure you want to delete "${serverName}"? This action cannot be undone.`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#dc2626',
                        cancelButtonColor: '#6b7280',
                        confirmButtonText: 'Yes, delete it!'
                    });

                    if (result.isConfirmed) {
                        await this.deleteServer(serverId, serverName);
                    }
                },

                async deleteServer(serverId, serverName) {
                    this.setLoadingState('Deleting VPS', `Deleting VPS "${serverName}"...`);
                    try {
                        const response = await fetch('/vps/delete', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: `server_id=${serverId}`
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            Swal.fire('Deleted!', `VPS "${serverName}" has been deleted.`, 'success');
                            await this.refreshServers();
                        } else {
                            Swal.fire('Error', data.error || 'Failed to delete VPS', 'error');
                        }
                    } catch (error) {
                        console.error('Error deleting server:', error);
                        Swal.fire('Error', 'Failed to delete VPS', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async powerOffServer(serverId, serverName) {
                    await this.performServerAction('poweroff', serverId, serverName, 'powering off');
                },

                async powerOnServer(serverId, serverName) {
                    await this.performServerAction('poweron', serverId, serverName, 'powering on');
                },

                async rebootServer(serverId, serverName) {
                    await this.performServerAction('reboot', serverId, serverName, 'rebooting');
                },

                async performServerAction(action, serverId, serverName, actionText) {
                    const actionTitles = {
                        'poweroff': 'Powering Off VPS',
                        'poweron': 'Powering On VPS', 
                        'reboot': 'Rebooting VPS'
                    };
                    this.setLoadingState(actionTitles[action] || 'VPS Action', `${actionText.charAt(0).toUpperCase() + actionText.slice(1)} "${serverName}"...`);
                    try {
                        const response = await fetch(`/vps/${action}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: `server_id=${serverId}`
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            Swal.fire('Success!', `VPS "${serverName}" is ${actionText}.`, 'success');
                            // Refresh after a short delay to allow status to update
                            setTimeout(() => this.refreshServers(), 2000);
                        } else {
                            Swal.fire('Error', data.error || `Failed to perform ${action}`, 'error');
                        }
                    } catch (error) {
                        console.error(`Error performing ${action}:`, error);
                        Swal.fire('Error', `Failed to perform ${action}`, 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                async downloadSSHKey() {
                    try {
                        // Create a temporary download link
                        const downloadUrl = '/vps/ssh-key?download=true';
                        const link = document.createElement('a');
                        link.href = downloadUrl;
                        link.download = 'xanthus-ssh-key.pem';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        Swal.fire({
                            title: 'SSH Key Downloaded!',
                            html: `
                                <div class="text-left text-sm">
                                    <p class="mb-2">Your SSH private key has been downloaded as <code>xanthus-ssh-key.pem</code></p>
                                    <p class="mb-2"><strong>Next steps:</strong></p>
                                    <ol class="list-decimal list-inside space-y-1 text-xs">
                                        <li>Set correct permissions: <code>chmod 600 xanthus-ssh-key.pem</code></li>
                                        <li>Connect to your VPS: <code>ssh -i xanthus-ssh-key.pem root@&lt;server-ip&gt;</code></li>
                                    </ol>
                                </div>
                            `,
                            icon: 'success',
                            confirmButtonText: 'Got it!'
                        });
                    } catch (error) {
                        console.error('Error downloading SSH key:', error);
                        Swal.fire('Error', 'Failed to download SSH key', 'error');
                    }
                },

                async showSSHInstructions() {
                    try {
                        const response = await fetch('/vps/ssh-key');
                        const data = await response.json();
                        
                        if (response.ok) {
                            Swal.fire({
                                title: 'SSH Setup Instructions',
                                html: `
                                    <div class="text-left text-sm">
                                        <div class="mb-4">
                                            <h4 class="font-semibold mb-2">üîë SSH Private Key:</h4>
                                            <textarea readonly class="w-full h-32 p-2 text-xs font-mono bg-gray-100 border rounded" onclick="this.select()">${data.private_key}</textarea>
                                            <p class="text-xs text-gray-600 mt-1">Click to select all text, then copy</p>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <h4 class="font-semibold mb-2">üìã Setup Steps:</h4>
                                            <ol class="list-decimal list-inside space-y-1 text-xs">
                                                <li>Save the key above to: <code>~/.ssh/xanthus-key.pem</code></li>
                                                <li>Set permissions: <code>chmod 600 ~/.ssh/xanthus-key.pem</code></li>
                                                <li>Connect: <code>ssh -i ~/.ssh/xanthus-key.pem root@&lt;server-ip&gt;</code></li>
                                            </ol>
                                        </div>
                                    </div>
                                `,
                                width: 600,
                                showCloseButton: true,
                                confirmButtonText: 'Close'
                            });
                        } else {
                            Swal.fire('Error', data.error || 'Failed to get SSH key', 'error');
                        }
                    } catch (error) {
                        console.error('Error getting SSH instructions:', error);
                        Swal.fire('Error', 'Failed to get SSH instructions', 'error');
                    }
                },

                async checkVPSStatus(serverId) {
                    this.setLoadingState('Health Check', 'Checking VPS status and services...');
                    try {
                        const response = await fetch(`/vps/${serverId}/status`);
                        const data = await response.json();
                        
                        if (response.ok) {
                            const statusColor = data.reachable ? 'success' : 'error';
                            const k3sStatus = data.k3s_status === 'active' ? '‚úÖ Running' : '‚ùå ' + data.k3s_status;
                            
                            // Setup status with progress indication
                            const setupStatusColors = {
                                'READY': '‚úÖ',
                                'VERIFYING': 'üîç',
                                'INSTALLING_ARGOCD_CLI': 'üì¶',
                                'WAITING_ARGOCD': '‚è≥',
                                'INSTALLING_ARGOCD': 'üì¶', 
                                'INSTALLING_HELM': 'üì¶',
                                'WAITING_K3S': '‚è≥',
                                'INSTALLING_K3S': 'üì¶',
                                'INSTALLING': 'üöÄ',
                                'UNKNOWN': '‚ùì'
                            };
                            const setupIcon = setupStatusColors[data.setup_status] || '‚ùì';
                            const setupStatus = `${setupIcon} ${data.setup_status || 'UNKNOWN'}`;
                            const setupMessage = data.setup_message || 'No status information available';
                            
                            // Show auto-refresh button for non-ready states
                            const showAutoRefresh = data.setup_status && data.setup_status !== 'READY';
                            
                            Swal.fire({
                                title: `VPS Status & Health`,
                                html: `
                                    <div class="text-left text-sm">
                                        <div class="mb-4 p-3 ${data.setup_status === 'READY' ? 'bg-green-50 border border-green-200' : 'bg-blue-50 border border-blue-200'} rounded-md">
                                            <h4 class="font-semibold mb-2">üöÄ Setup Status:</h4>
                                            <div class="font-medium">${setupStatus}</div>
                                            <div class="text-xs text-gray-600 mt-1">${setupMessage}</div>
                                            ${showAutoRefresh ? '<div class="text-xs text-blue-600 mt-2">üí° This dialog will auto-refresh every 5 seconds while setup is in progress</div>' : ''}
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-2 mb-4">
                                            <div><strong>SSH:</strong> ${data.reachable ? '‚úÖ Connected' : '‚ùå Failed'}</div>
                                            <div><strong>K3s:</strong> ${k3sStatus}</div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <h4 class="font-semibold mb-2">üñ•Ô∏è System Load:</h4>
                                            <pre class="text-xs bg-gray-100 p-2 rounded">${data.system_load?.uptime || 'N/A'}</pre>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <h4 class="font-semibold mb-2">üíæ Memory:</h4>
                                            <pre class="text-xs bg-gray-100 p-2 rounded">${data.system_load?.memory || 'N/A'}</pre>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <h4 class="font-semibold mb-2">üíø Disk Usage:</h4>
                                            <pre class="text-xs bg-gray-100 p-2 rounded">${data.disk_usage?.root || 'N/A'}</pre>
                                        </div>
                                        
                                        <div>
                                            <h4 class="font-semibold mb-2">üîß Services:</h4>
                                            <div class="text-xs">
                                                ${Object.entries(data.services || {}).map(([service, status]) => 
                                                    `<div>${service}: ${status === 'active' ? '‚úÖ' : '‚ùå'} ${status}</div>`
                                                ).join('')}
                                            </div>
                                        </div>
                                    </div>
                                `,
                                icon: statusColor,
                                width: 600,
                                confirmButtonText: 'Close',
                                didOpen: () => {
                                    // Auto-refresh for non-ready states
                                    if (showAutoRefresh) {
                                        const refreshInterval = setInterval(async () => {
                                            try {
                                                const refreshResponse = await fetch(`/vps/${serverId}/status`);
                                                const refreshData = await refreshResponse.json();
                                                
                                                if (refreshResponse.ok) {
                                                    const newSetupIcon = setupStatusColors[refreshData.setup_status] || '‚ùì';
                                                    const newSetupStatus = `${newSetupIcon} ${refreshData.setup_status || 'UNKNOWN'}`;
                                                    const newSetupMessage = refreshData.setup_message || 'No status information available';
                                                    
                                                    // Update the setup status section
                                                    const statusDiv = document.querySelector('.swal2-html-container div div');
                                                    if (statusDiv) {
                                                        statusDiv.innerHTML = `
                                                            <h4 class="font-semibold mb-2">üöÄ Setup Status:</h4>
                                                            <div class="font-medium">${newSetupStatus}</div>
                                                            <div class="text-xs text-gray-600 mt-1">${newSetupMessage}</div>
                                                            ${refreshData.setup_status !== 'READY' ? '<div class="text-xs text-blue-600 mt-2">üí° This dialog will auto-refresh every 5 seconds while setup is in progress</div>' : '<div class="text-xs text-green-600 mt-2">üéâ Setup completed! All components are ready.</div>'}
                                                        `;
                                                        
                                                        // Change background color when ready
                                                        if (refreshData.setup_status === 'READY') {
                                                            statusDiv.parentElement.className = 'mb-4 p-3 bg-green-50 border border-green-200 rounded-md';
                                                            clearInterval(refreshInterval);
                                                        }
                                                    }
                                                }
                                            } catch (error) {
                                                console.log('Auto-refresh failed:', error);
                                            }
                                        }, 5000);
                                        
                                        // Clear interval when modal is closed
                                        const observer = new MutationObserver((mutations) => {
                                            mutations.forEach((mutation) => {
                                                if (!document.querySelector('.swal2-container')) {
                                                    clearInterval(refreshInterval);
                                                    observer.disconnect();
                                                }
                                            });
                                        });
                                        observer.observe(document.body, { childList: true, subtree: true });
                                    }
                                }
                            });
                        } else {
                            Swal.fire('Error', data.error || 'Failed to check VPS status', 'error');
                        }
                    } catch (error) {
                        console.error('Error checking VPS status:', error);
                        Swal.fire('Error', 'Failed to check VPS status', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async showVPSLogs(serverId) {
                    this.setLoadingState('Loading Logs', 'Retrieving K3s service logs...');
                    try {
                        const response = await fetch(`/vps/${serverId}/logs?lines=100`);
                        const data = await response.json();
                        
                        if (response.ok) {
                            Swal.fire({
                                title: 'K3s Service Logs',
                                html: `
                                    <div class="text-left">
                                        <div class="mb-2 text-sm text-gray-600">
                                            Server: ${serverId} | Lines: ${data.lines} | ${data.timestamp}
                                        </div>
                                        <textarea readonly class="w-full h-96 p-2 text-xs font-mono bg-gray-100 border rounded" onclick="this.select()">${data.logs}</textarea>
                                        <p class="text-xs text-gray-600 mt-1">Click to select all logs</p>
                                    </div>
                                `,
                                width: 800,
                                showCloseButton: true,
                                confirmButtonText: 'Close'
                            });
                        } else {
                            Swal.fire('Error', data.error || 'Failed to get VPS logs', 'error');
                        }
                    } catch (error) {
                        console.error('Error getting VPS logs:', error);
                        Swal.fire('Error', 'Failed to get VPS logs', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async showConfigureVPS(serverId) {
                    // First, get the list of available domains
                    try {
                        const domainsResponse = await fetch('/dns/list');
                        const domainsData = await domainsResponse.json();
                        
                        if (!domainsResponse.ok) {
                            Swal.fire('Error', 'Failed to load domains', 'error');
                            return;
                        }

                        const domains = domainsData.domains || [];
                        const managedDomains = domains.filter(d => d.managed_by_xanthus);
                        
                        if (managedDomains.length === 0) {
                            Swal.fire('No Domains', 'No managed domains found. Please configure SSL for a domain first.', 'warning');
                            return;
                        }

                        const domainOptions = managedDomains.map(d => 
                            `<option value="${d.name}">${d.name}</option>`
                        ).join('');

                        const { value: formValues } = await Swal.fire({
                            title: 'Configure VPS',
                            html: `
                                <div class="text-left">
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Select Domain for SSL Configuration:
                                        </label>
                                        <select id="domain-select" class="w-full p-2 border border-gray-300 rounded-md">
                                            ${domainOptions}
                                        </select>
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        This will update the K3s cluster with SSL certificates for the selected domain.
                                    </div>
                                </div>
                            `,
                            focusConfirm: false,
                            showCancelButton: true,
                            confirmButtonText: 'Configure',
                            cancelButtonText: 'Cancel',
                            preConfirm: () => {
                                const domain = document.getElementById('domain-select').value;
                                return { domain };
                            }
                        });

                        if (formValues) {
                            await this.configureVPS(serverId, formValues.domain);
                        }
                    } catch (error) {
                        console.error('Error showing configure dialog:', error);
                        Swal.fire('Error', 'Failed to load configuration dialog', 'error');
                    }
                },

                async configureVPS(serverId, domain) {
                    this.setLoadingState('Configuring VPS', `Configuring SSL for domain "${domain}"...`);
                    try {
                        const response = await fetch(`/vps/${serverId}/configure`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: `domain=${encodeURIComponent(domain)}`
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            Swal.fire('Success!', data.message, 'success');
                        } else {
                            Swal.fire('Error', data.error || 'Failed to configure VPS', 'error');
                        }
                    } catch (error) {
                        console.error('Error configuring VPS:', error);
                        Swal.fire('Error', 'Failed to configure VPS', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                setLoadingState(title, message) {
                    this.loadingTitle = title;
                    this.loadingMessage = message;
                    this.loading = true;
                },

                async openTerminal(serverId, serverName) {
                    this.setLoadingState('Opening Terminal', `Creating SSH terminal for "${serverName}"...`);
                    try {
                        const response = await fetch(`/vps/${serverId}/terminal`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            // Open terminal in a modal
                            Swal.fire({
                                title: `SSH Terminal - ${serverName}`,
                                html: `
                                    <div class="text-left">
                                        <div class="mb-4 text-sm text-gray-600">
                                            Server: ${serverName} | Session: ${data.session_id}
                                        </div>
                                        <iframe 
                                            src="http://localhost:${data.port}" 
                                            width="100%" 
                                            height="500" 
                                            frameborder="0"
                                            style="border-radius: 4px; background: #000;">
                                        </iframe>
                                        <div class="mt-2 text-xs text-gray-500">
                                            Terminal session will auto-close when this dialog is closed.
                                        </div>
                                    </div>
                                `,
                                width: 900,
                                showCloseButton: true,
                                showConfirmButton: false,
                                willClose: () => {
                                    // Clean up terminal session when modal closes
                                    fetch(`/terminal/${data.session_id}`, {
                                        method: 'DELETE'
                                    }).catch(err => console.log('Failed to cleanup terminal session:', err));
                                }
                            });
                        } else {
                            Swal.fire('Error', data.error || 'Failed to create terminal session', 'error');
                        }
                    } catch (error) {
                        console.error('Error opening terminal:', error);
                        Swal.fire('Error', 'Failed to open terminal', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async openTerminalNewTab(serverId, serverName) {
                    this.setLoadingState('Opening Terminal', `Creating SSH terminal for "${serverName}"...`);
                    try {
                        const response = await fetch(`/vps/${serverId}/terminal`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            // Open terminal in new tab
                            const terminalUrl = `http://localhost:${data.port}`;
                            const newTab = window.open(terminalUrl, '_blank');
                            
                            if (newTab) {
                                Swal.fire({
                                    title: 'Terminal Opened',
                                    html: `
                                        <div class="text-left text-sm">
                                            <p class="mb-2">SSH terminal opened in new tab for <strong>${serverName}</strong></p>
                                            <div class="bg-gray-100 p-2 rounded mb-2">
                                                <strong>Session ID:</strong> ${data.session_id}<br>
                                                <strong>URL:</strong> <a href="${terminalUrl}" target="_blank" class="text-blue-600">${terminalUrl}</a>
                                            </div>
                                            <p class="text-gray-600">Close the tab when done to free up resources.</p>
                                        </div>
                                    `,
                                    icon: 'success',
                                    confirmButtonText: 'OK'
                                });
                            } else {
                                Swal.fire('Popup Blocked', 'Please allow popups for this site to open terminal in new tab', 'warning');
                            }
                        } else {
                            Swal.fire('Error', data.error || 'Failed to create terminal session', 'error');
                        }
                    } catch (error) {
                        console.error('Error opening terminal:', error);
                        Swal.fire('Error', 'Failed to open terminal', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                // Show cost information popup
                showCostInfo() {
                    Swal.fire({
                        title: 'üí∞ Monthly Cost',
                        html: `
                            <div class="text-left text-sm">
                                <div class="mb-4">
                                    <p class="text-gray-700 mb-2">The monthly cost includes:</p>
                                    <ul class="list-disc list-inside text-gray-600 space-y-1">
                                        <li>Server resources (CPU, RAM, storage)</li>
                                        <li>IPv4 address (‚Ç¨0.50/month)</li>
                                        <li>Bandwidth and network usage</li>
                                    </ul>
                                </div>
                                
                                <div class="p-3 bg-blue-50 border border-blue-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="h-4 w-4 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                        </svg>
                                        <div>
                                            <strong class="text-blue-800">Note:</strong><br>
                                            <span class="text-blue-700">This is the standard monthly rate. If you delete the VPS before the month ends, you'll be charged the hourly rate instead.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        icon: 'info',
                        confirmButtonText: 'Got it!',
                        confirmButtonColor: '#2563eb',
                        width: 500
                    });
                },

                // Show accumulated cost information popup
                showAccumulatedCostInfo(server) {
                    // Get the hourly rate from the specific server passed as parameter
                    const hourlyRate = server?.labels?.hourly_cost || 'N/A';
                    
                    Swal.fire({
                        title: 'üìä Accumulated Cost',
                        html: `
                            <div class="text-left text-sm">
                                <div class="mb-4">
                                    <p class="text-gray-700 mb-2">The accumulated cost represents:</p>
                                    <ul class="list-disc list-inside text-gray-600 space-y-1">
                                        <li>Total charges since VPS creation</li>
                                        <li>Based on actual usage time (hours √ó hourly rate)</li>
                                        <li>Updated in real-time based on current timestamp</li>
                                        <li>Includes all server resources and IPv4 costs</li>
                                    </ul>
                                </div>
                                
                                <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="h-4 w-4 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" clip-rule="evenodd" />
                                        </svg>
                                        <div>
                                            <strong class="text-blue-800">Current Hourly Rate:</strong><br>
                                            <span class="text-blue-700">‚Ç¨${hourlyRate}/hour (includes server resources + IPv4 address cost)</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="p-3 bg-amber-50 border border-amber-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="h-4 w-4 text-amber-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                        </svg>
                                        <div>
                                            <strong class="text-amber-800">Important:</strong><br>
                                            <span class="text-amber-700">This is what you'll be charged if you delete the VPS now, rather than waiting for the full month.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        icon: 'info',
                        confirmButtonText: 'Got it!',
                        confirmButtonColor: '#2563eb',
                        width: 500
                    });
                },

                // Show hourly rate information popup
                showHourlyRateInfo() {
                    Swal.fire({
                        title: '‚è∞ Hourly Rate',
                        html: `
                            <div class="text-left text-sm">
                                <div class="mb-4">
                                    <p class="text-gray-700 mb-2">The hourly rate includes:</p>
                                    <ul class="list-disc list-inside text-gray-600 space-y-1">
                                        <li>Server resources per hour</li>
                                        <li>IPv4 address cost (‚Ç¨0.50/month √∑ 730 hours)</li>
                                        <li>All network and bandwidth usage</li>
                                    </ul>
                                </div>
                                
                                <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="h-4 w-4 text-green-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                        </svg>
                                        <div>
                                            <strong class="text-green-800">Cost Savings:</strong><br>
                                            <span class="text-green-700">Using hourly billing when deleting early can save money compared to paying the full monthly rate.</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="p-3 bg-blue-50 border border-blue-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="h-4 w-4 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                        </svg>
                                        <div>
                                            <strong class="text-blue-800">Billing:</strong><br>
                                            <span class="text-blue-700">Hetzner charges hourly until you reach the monthly cap, then switches to monthly billing.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        icon: 'info', 
                        confirmButtonText: 'Got it!',
                        confirmButtonColor: '#2563eb',
                        width: 550
                    });
                },

                // Cleanup on component destroy
                destroy() {
                    this.stopAutoRefresh();
                }
            }
        }
    </script>
</body>
</html>